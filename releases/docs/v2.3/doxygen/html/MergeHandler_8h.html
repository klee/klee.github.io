<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>klee: /Users/cristic/klee/lib/Core/MergeHandler.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">klee
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('MergeHandler_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">MergeHandler.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of the region based merging.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="Ref_8h_source.html">klee/ADT/Ref.h</a>&quot;</code><br />
<code>#include &quot;llvm/Support/CommandLine.h&quot;</code><br />
<code>#include &lt;map&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for MergeHandler.h:</div>
<div class="dyncontent">
<div class="center"><img src="MergeHandler_8h__incl.png" border="0" usemap="#a_2Users_2cristic_2klee_2lib_2Core_2MergeHandler_8h" alt=""/></div>
<map name="a_2Users_2cristic_2klee_2lib_2Core_2MergeHandler_8h" id="a_2Users_2cristic_2klee_2lib_2Core_2MergeHandler_8h">
<area shape="rect" title="Implementation of the region based merging." alt="" coords="473,5,639,47"/>
<area shape="rect" href="Ref_8h.html" title="Implements smart&#45;pointer ref&lt;&gt; used by KLEE." alt="" coords="175,95,289,121"/>
<area shape="rect" title=" " alt="" coords="313,95,508,121"/>
<area shape="rect" title=" " alt="" coords="533,95,579,121"/>
<area shape="rect" title=" " alt="" coords="603,95,669,121"/>
<area shape="rect" title=" " alt="" coords="693,95,752,121"/>
<area shape="rect" href="Casting_8h.html" title=" " alt="" coords="88,169,243,196"/>
<area shape="rect" title=" " alt="" coords="267,169,333,196"/>
<area shape="rect" href="Version_8h.html" title=" " alt="" coords="5,244,152,271"/>
<area shape="rect" title=" " alt="" coords="176,244,331,271"/>
<area shape="rect" title=" " alt="" coords="9,319,148,345"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="MergeHandler_8h__dep__incl.png" border="0" usemap="#a_2Users_2cristic_2klee_2lib_2Core_2MergeHandler_8hdep" alt=""/></div>
<map name="a_2Users_2cristic_2klee_2lib_2Core_2MergeHandler_8hdep" id="a_2Users_2cristic_2klee_2lib_2Core_2MergeHandler_8hdep">
<area shape="rect" title="Implementation of the region based merging." alt="" coords="786,5,953,47"/>
<area shape="rect" href="ExecutionState_8h.html" title=" " alt="" coords="782,95,957,136"/>
<area shape="rect" href="MergeHandler_8cpp.html" title=" " alt="" coords="614,273,794,315"/>
<area shape="rect" href="Searcher_8cpp.html" title=" " alt="" coords="186,273,337,315"/>
<area shape="rect" href="SpecialFunctionHandler_8cpp.html" title=" " alt="" coords="1592,273,1830,315"/>
<area shape="rect" href="UserSearcher_8cpp.html" title=" " alt="" coords="994,273,1172,315"/>
<area shape="rect" href="AddressSpace_8cpp.html" title=" " alt="" coords="1176,184,1361,225"/>
<area shape="rect" href="ExecutionState_8cpp.html" title=" " alt="" coords="1386,184,1575,225"/>
<area shape="rect" href="Executor_8cpp.html" title=" " alt="" coords="818,273,969,315"/>
<area shape="rect" href="Executor_8h.html" title=" " alt="" coords="1014,184,1152,225"/>
<area shape="rect" href="StatsTracker_8cpp.html" title=" " alt="" coords="1393,273,1568,315"/>
<area shape="rect" href="Memory_8cpp.html" title=" " alt="" coords="45,184,190,225"/>
<area shape="rect" href="PTree_8cpp.html" title=" " alt="" coords="214,184,349,225"/>
<area shape="rect" href="Searcher_8h.html" title=" " alt="" coords="801,184,938,225"/>
<area shape="rect" href="SeedInfo_8cpp.html" title=" " alt="" coords="374,184,526,225"/>
<area shape="rect" href="TimingSolver_8cpp.html" title=" " alt="" coords="550,184,725,225"/>
<area shape="rect" href="ExecutorUtil_8cpp.html" title=" " alt="" coords="1197,273,1369,315"/>
</map>
</div>
</div>
<p><a href="MergeHandler_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classklee_1_1MergeHandler.html">klee::MergeHandler</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents one <code><a class="el" href="klee_8h.html#a13dc896b53e79e655dcd6606d355d19d">klee_open_merge()</a></code> call. Handles merging of states that branched from it.  <a href="classklee_1_1MergeHandler.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="namespaces" name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacellvm"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacellvm.html">llvm</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespaceklee"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceklee.html">klee</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a59ed4878f1f45e8babf90aba7a813474"><td class="memItemLeft" align="right" valign="top">llvm::cl::opt&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceklee.html#a59ed4878f1f45e8babf90aba7a813474">klee::UseMerge</a></td></tr>
<tr class="separator:a59ed4878f1f45e8babf90aba7a813474"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a681a411cfb19deb338557ae7ac3b2c69"><td class="memItemLeft" align="right" valign="top">llvm::cl::opt&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceklee.html#a681a411cfb19deb338557ae7ac3b2c69">klee::DebugLogMerge</a></td></tr>
<tr class="separator:a681a411cfb19deb338557ae7ac3b2c69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a459af63ae00d250b8341c343a82f67f7"><td class="memItemLeft" align="right" valign="top">llvm::cl::opt&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceklee.html#a459af63ae00d250b8341c343a82f67f7">klee::DebugLogIncompleteMerge</a></td></tr>
<tr class="separator:a459af63ae00d250b8341c343a82f67f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Implementation of the region based merging. </p>
<h2><a class="anchor" id="autotoc_md0"></a>
Basic usage:</h2>
<div class="fragment"><div class="line"><a class="code hl_function" href="klee_8h.html#a13dc896b53e79e655dcd6606d355d19d">klee_open_merge</a>();</div>
<div class="line"> </div>
<div class="line">code containing branches etc. </div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="klee_8h.html#ab88e96df786a26f6c3d8dba7a1af9110">klee_close_merge</a>();</div>
<div class="ttc" id="aklee_8h_html_a13dc896b53e79e655dcd6606d355d19d"><div class="ttname"><a href="klee_8h.html#a13dc896b53e79e655dcd6606d355d19d">klee_open_merge</a></div><div class="ttdeci">void klee_open_merge(void)</div></div>
<div class="ttc" id="aklee_8h_html_ab88e96df786a26f6c3d8dba7a1af9110"><div class="ttname"><a href="klee_8h.html#ab88e96df786a26f6c3d8dba7a1af9110">klee_close_merge</a></div><div class="ttdeci">void klee_close_merge(void)</div></div>
</div><!-- fragment --><p >Will lead to all states that forked from the state that executed the <a class="el" href="klee_8h.html#a13dc896b53e79e655dcd6606d355d19d">klee_open_merge()</a> being merged in the <a class="el" href="klee_8h.html#ab88e96df786a26f6c3d8dba7a1af9110">klee_close_merge()</a>. This allows for fine-grained regions to be specified for merging.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Implementation Structure</h1>
<p >The main part of the new functionality is implemented in the class <a class="el" href="classklee_1_1MergeHandler.html" title="Represents one klee_open_merge() call. Handles merging of states that branched from it.">klee::MergeHandler</a>. The Special Function Handler generates an instance of this class every time a state runs into a <a class="el" href="klee_8h.html#a13dc896b53e79e655dcd6606d355d19d">klee_open_merge()</a> call.</p>
<p >This instance is appended to a <code>std::vector&lt;<a class="el" href="classklee_1_1ref.html">klee::ref</a>&lt;<a class="el" href="classklee_1_1MergeHandler.html" title="Represents one klee_open_merge() call. Handles merging of states that branched from it.">klee::MergeHandler</a>&gt;&gt;</code> in the ExecutionState that passed the merge open point. This stack is also copied during forks. We use a stack instead of a single instance to support nested merge regions.</p>
<p >Once a state runs into a <code><a class="el" href="klee_8h.html#ab88e96df786a26f6c3d8dba7a1af9110">klee_close_merge()</a></code>, the Special Function Handler notifies the top <a class="el" href="classklee_1_1MergeHandler.html" title="Represents one klee_open_merge() call. Handles merging of states that branched from it.">klee::MergeHandler</a> in the state's stack, pauses the state from scheduling, and tries to merge it with all other states that already arrived at the same close merge point. This top instance is then popped from the stack, resulting in a decrease of the ref count of the <a class="el" href="classklee_1_1MergeHandler.html" title="Represents one klee_open_merge() call. Handles merging of states that branched from it.">klee::MergeHandler</a>.</p>
<p >Since the only references to this MergeHandler are in the stacks of the ExecutionStates currently in the merging region, once the ref count reaches zero, every state which ran into the same <code><a class="el" href="klee_8h.html#a13dc896b53e79e655dcd6606d355d19d">klee_open_merge()</a></code> is now paused and waiting to be merged. The destructor of the MergeHandler then continues the scheduling of the corresponding paused states.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Non-blocking State Merging</h1>
<p >This feature adds functionality to the BoundedMergingSearcher that will prioritize (e.g., immediately schedule) states running inside a bounded-merge region once a state has reached a corresponding <a class="el" href="klee_8h.html#ab88e96df786a26f6c3d8dba7a1af9110">klee_close_merge()</a> call. The goal is to quickly gather all states inside the merging region in order to release the waiting states. However, states that are running for more than twice the mean number of instructions compared to the states that are already waiting, will not be prioritized anymore.</p>
<p >Once no more states are available for prioritizing, but there are states waiting to be released, these states (which have already been merged as good as possible) will be continued without waiting for the remaining states. When a remaining state now enters a close-merge point, it will again wait for the other states, or until the 'timeout' is reached. </p>

<p class="definition">Definition in file <a class="el" href="MergeHandler_8h_source.html">MergeHandler.h</a>.</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a7e9f68611f01b5eb6ddd8cd40b75845.html">Core</a></li><li class="navelem"><a class="el" href="MergeHandler_8h.html">MergeHandler.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
